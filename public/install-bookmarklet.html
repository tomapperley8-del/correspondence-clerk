<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Install Outlook Bookmarklet - Correspondence Clerk</title>
  <style>
    :root {
      --black: #000000;
      --white: #ffffff;
      --olive: #98bf64;
      --grey: #333333;
      --light-grey: #f5f5f5;
      --medium-grey: #777777;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      color: var(--grey);
      background: var(--white);
    }

    header {
      background: var(--black);
      color: var(--white);
      text-align: center;
      padding: 60px 20px;
      margin-bottom: 40px;
    }

    header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      font-weight: 700;
    }

    header p {
      font-size: 1.3em;
      color: var(--olive);
      font-weight: 500;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 0 20px 60px 20px;
    }

    .version-toggle {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 40px;
    }

    .version-btn {
      padding: 12px 30px;
      border: 2px solid var(--olive);
      background: var(--white);
      color: var(--grey);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .version-btn:hover {
      background: var(--light-grey);
    }

    .version-btn.active {
      background: var(--olive);
      color: var(--white);
    }

    .version-content {
      display: none;
    }

    .version-content.active {
      display: block;
    }

    .installer-box {
      background: var(--light-grey);
      border: 3px solid var(--grey);
      padding: 40px;
      text-align: center;
      margin-bottom: 40px;
    }

    .installer-box h2 {
      font-size: 1.5em;
      margin-bottom: 20px;
      color: var(--grey);
    }

    .installer-box p {
      font-size: 1.1em;
      margin-bottom: 30px;
      color: var(--medium-grey);
    }

    .drag-instruction {
      font-size: 2em;
      margin-bottom: 20px;
    }

    .bookmarklet-button {
      display: inline-block;
      padding: 25px 50px;
      background: var(--olive);
      color: var(--white);
      font-size: 20px;
      font-weight: bold;
      text-decoration: none;
      border: 3px dashed var(--grey);
      cursor: move;
      transition: all 0.3s ease;
      user-select: none;
    }

    .bookmarklet-button:hover {
      background: #7a9d4f;
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .bookmarklet-button:active {
      transform: scale(0.98);
    }

    .steps-section {
      margin-bottom: 50px;
    }

    .steps-section h2 {
      font-size: 2em;
      margin-bottom: 25px;
      color: var(--black);
      border-bottom: 3px solid var(--olive);
      padding-bottom: 10px;
    }

    .steps {
      list-style: none;
      counter-reset: step-counter;
    }

    .steps li {
      counter-increment: step-counter;
      position: relative;
      padding: 20px 20px 20px 70px;
      margin-bottom: 15px;
      background: var(--light-grey);
      border-left: 4px solid var(--olive);
    }

    .steps li::before {
      content: counter(step-counter);
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      width: 35px;
      height: 35px;
      background: var(--olive);
      color: var(--white);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 18px;
    }

    .steps li strong {
      color: var(--black);
      font-size: 1.1em;
    }

    .how-to-use {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 50px;
    }

    .step-card {
      background: var(--light-grey);
      padding: 30px 20px;
      text-align: center;
      border-top: 4px solid var(--olive);
    }

    .step-card .icon {
      font-size: 3em;
      margin-bottom: 15px;
    }

    .step-card h3 {
      font-size: 1.2em;
      margin-bottom: 10px;
      color: var(--black);
    }

    .step-card p {
      color: var(--medium-grey);
      font-size: 0.95em;
    }

    .troubleshooting {
      margin-bottom: 50px;
    }

    .troubleshooting h2 {
      font-size: 2em;
      margin-bottom: 25px;
      color: var(--black);
      border-bottom: 3px solid var(--olive);
      padding-bottom: 10px;
    }

    details {
      background: var(--light-grey);
      padding: 20px;
      margin-bottom: 15px;
      cursor: pointer;
      border-left: 4px solid var(--olive);
    }

    details summary {
      font-weight: 600;
      font-size: 1.1em;
      color: var(--black);
      list-style-position: outside;
      padding-left: 10px;
    }

    details summary::marker {
      color: var(--olive);
    }

    details[open] summary {
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--medium-grey);
    }

    details p {
      color: var(--grey);
      line-height: 1.8;
    }

    details ul {
      margin-left: 20px;
      margin-top: 10px;
    }

    details li {
      margin-bottom: 8px;
      color: var(--grey);
    }

    .support-section {
      background: var(--black);
      color: var(--white);
      padding: 40px;
      text-align: center;
      margin: 0 -20px;
    }

    .support-section h2 {
      font-size: 1.8em;
      margin-bottom: 15px;
    }

    .support-section a {
      color: var(--olive);
      text-decoration: none;
      font-weight: 600;
      font-size: 1.1em;
    }

    .support-section a:hover {
      text-decoration: underline;
    }

    .note {
      background: #fff9e6;
      border-left: 4px solid #f4c430;
      padding: 15px 20px;
      margin: 20px 0;
      color: var(--grey);
    }

    .note strong {
      color: var(--black);
    }

    @media (max-width: 768px) {
      header h1 {
        font-size: 1.8em;
      }

      header p {
        font-size: 1.1em;
      }

      .installer-box {
        padding: 20px;
      }

      .bookmarklet-button {
        padding: 20px 30px;
        font-size: 16px;
      }

      .steps li {
        padding-left: 60px;
      }

      .how-to-use {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>ðŸ“§ Outlook â†’ Correspondence Clerk</h1>
    <p>File emails in one click</p>
  </header>

  <div class="container">
    <!-- Version Toggle -->
    <div class="version-toggle">
      <button class="version-btn active" onclick="switchVersion('production')">Production</button>
      <button class="version-btn" onclick="switchVersion('local')">Local Dev</button>
    </div>

    <!-- Production Version -->
    <div id="production-version" class="version-content active">
      <div class="installer-box">
        <h2>Production Bookmarklet</h2>
        <p class="drag-instruction">ðŸ‘‡ Drag this button to your bookmarks bar</p>
        <a href="javascript:(function(){var url='https://correspondence-clerk.vercel.app';if(!window.location.hostname.includes('outlook')&&!window.location.hostname.includes('office.com')&&!window.location.hostname.includes('live.com')){alert('Please open while viewing an email in Outlook Web.');return;}function parseEmailAddress(text){if(!text)return{email:'',name:''};var emailRegex=/[\w\.-]+@[\w\.-]+\.\w+/;var match=text.match(emailRegex);var email=match?match[0]:'';var name='';if(text.includes('<')&&text.includes('>')){name=text.substring(0,text.indexOf('<')).trim();}else if(text!==email&&!text.includes('@')){name=text.trim();}return{email:email,name:name};}function extractBodyText(element){if(!element)return'';var clone=element.cloneNode(true);var sigs=clone.querySelectorAll('[class*=\"signature\"],[id*=\"signature\"]');sigs.forEach(function(s){s.remove();});var quoted=clone.querySelectorAll('[class*=\"quote\"],[class*=\"reply\"]');quoted.forEach(function(q){q.remove();});var text=clone.textContent||clone.innerText||'';text=text.replace(/\n\s*\n\s*\n/g,'\n\n');return text.trim();}try{var subject='',body='',from={email:'',name:''},to=[],date=new Date().toISOString();var headings=document.querySelectorAll('[role=\"heading\"]');var fromText='',toText='',dateText='';headings.forEach(function(h){var txt=h.textContent.trim();if(txt.includes('<')&&txt.includes('@')&&txt.includes('>')){fromText=txt;}else if(txt.startsWith('To:')||txt.startsWith('To:â€‹')){toText=txt.replace(/^To:â€‹?/,'').trim();}else if(txt.match(/\d{2}\/\d{2}\/\d{4}\s+\d{2}:\d{2}/)){dateText=txt;}});if(fromText){from=parseEmailAddress(fromText);}if(toText){to=[parseEmailAddress(toText)];}if(dateText){var parts=dateText.match(/(\d{2})\/(\d{2})\/(\d{4})\s+(\d{2}):(\d{2})/);if(parts){var d=new Date(parts[3],parts[2]-1,parts[1],parts[4],parts[5]);if(!isNaN(d.getTime()))date=d.toISOString();}}var subjectCandidates=document.querySelectorAll('h1,h2,h3,h4,[role=\"heading\"]');for(var i=0;i<subjectCandidates.length;i++){var txt=subjectCandidates[i].textContent.trim();if(txt.length>5&&txt.length<200&&!txt.includes('@')&&!txt.startsWith('To:')&&!txt.startsWith('Cc:')&&!txt.match(/\d{2}\/\d{2}\/\d{4}/)&&txt!=='Navigation pane'&&txt!=='Inbox'){subject=txt;break;}}var bodyEl=document.querySelector('[role=\"document\"]')||document.querySelector('.customScrollBar')||document.querySelector('[role=\"main\"]');body=extractBodyText(bodyEl);if(!body){alert('Could not extract email body.');return;}var fromStr=from.name?from.name+' <'+from.email+'>':from.email;var toStr=to.map(function(t){return t.name?t.name+' <'+t.email+'>':t.email;}).join(', ');var params=new URLSearchParams({emailSubject:subject,emailBody:body,emailFrom:fromStr,emailFromEmail:from.email,emailFromName:from.name,emailDate:date,emailTo:toStr,emailRawContent:'From: '+fromStr+'\nTo: '+toStr+'\nDate: '+new Date(date).toLocaleString('en-GB')+'\nSubject: '+subject+'\n\n'+body});window.open(url+'/new-entry?'+params.toString(),'_blank');}catch(error){alert('Error: '+error.message);}})();"
           class="bookmarklet-button">
          ðŸ“§ Send to Correspondence
        </a>
        <p style="margin-top: 20px; font-size: 0.9em; color: var(--medium-grey);">
          Points to: <code style="background: var(--white); padding: 2px 8px;">https://correspondence-clerk.vercel.app</code>
        </p>
      </div>
    </div>

    <!-- Local Dev Version -->
    <div id="local-version" class="version-content">
      <div class="installer-box">
        <h2>Local Development Bookmarklet</h2>
        <p class="drag-instruction">ðŸ‘‡ Drag this button to your bookmarks bar</p>
        <a href="javascript:(function(){var url='http://localhost:3000';if(!window.location.hostname.includes('outlook')&&!window.location.hostname.includes('office.com')&&!window.location.hostname.includes('live.com')){alert('Please open while viewing an email in Outlook Web.');return;}function parseEmailAddress(text){if(!text)return{email:'',name:''};var emailRegex=/[\w\.-]+@[\w\.-]+\.\w+/;var match=text.match(emailRegex);var email=match?match[0]:'';var name='';if(text.includes('<')&&text.includes('>')){name=text.substring(0,text.indexOf('<')).trim();}else if(text!==email&&!text.includes('@')){name=text.trim();}return{email:email,name:name};}function extractBodyText(element){if(!element)return'';var clone=element.cloneNode(true);var sigs=clone.querySelectorAll('[class*=\"signature\"],[id*=\"signature\"]');sigs.forEach(function(s){s.remove();});var quoted=clone.querySelectorAll('[class*=\"quote\"],[class*=\"reply\"]');quoted.forEach(function(q){q.remove();});var text=clone.textContent||clone.innerText||'';text=text.replace(/\n\s*\n\s*\n/g,'\n\n');return text.trim();}try{var subject='',body='',from={email:'',name:''},to=[],date=new Date().toISOString();var headings=document.querySelectorAll('[role=\"heading\"]');var fromText='',toText='',dateText='';headings.forEach(function(h){var txt=h.textContent.trim();if(txt.includes('<')&&txt.includes('@')&&txt.includes('>')){fromText=txt;}else if(txt.startsWith('To:')||txt.startsWith('To:â€‹')){toText=txt.replace(/^To:â€‹?/,'').trim();}else if(txt.match(/\d{2}\/\d{2}\/\d{4}\s+\d{2}:\d{2}/)){dateText=txt;}});if(fromText){from=parseEmailAddress(fromText);}if(toText){to=[parseEmailAddress(toText)];}if(dateText){var parts=dateText.match(/(\d{2})\/(\d{2})\/(\d{4})\s+(\d{2}):(\d{2})/);if(parts){var d=new Date(parts[3],parts[2]-1,parts[1],parts[4],parts[5]);if(!isNaN(d.getTime()))date=d.toISOString();}}var subjectCandidates=document.querySelectorAll('h1,h2,h3,h4,[role=\"heading\"]');for(var i=0;i<subjectCandidates.length;i++){var txt=subjectCandidates[i].textContent.trim();if(txt.length>5&&txt.length<200&&!txt.includes('@')&&!txt.startsWith('To:')&&!txt.startsWith('Cc:')&&!txt.match(/\d{2}\/\d{2}\/\d{4}/)&&txt!=='Navigation pane'&&txt!=='Inbox'){subject=txt;break;}}var bodyEl=document.querySelector('[role=\"document\"]')||document.querySelector('.customScrollBar')||document.querySelector('[role=\"main\"]');body=extractBodyText(bodyEl);if(!body){alert('Could not extract email body.');return;}var fromStr=from.name?from.name+' <'+from.email+'>':from.email;var toStr=to.map(function(t){return t.name?t.name+' <'+t.email+'>':t.email;}).join(', ');var params=new URLSearchParams({emailSubject:subject,emailBody:body,emailFrom:fromStr,emailFromEmail:from.email,emailFromName:from.name,emailDate:date,emailTo:toStr,emailRawContent:'From: '+fromStr+'\nTo: '+toStr+'\nDate: '+new Date(date).toLocaleString('en-GB')+'\nSubject: '+subject+'\n\n'+body});window.open(url+'/new-entry?'+params.toString(),'_blank');}catch(error){alert('Error: '+error.message);}})();"
           class="bookmarklet-button">
          ðŸ“§ Send to Correspondence (Local)
        </a>
        <p style="margin-top: 20px; font-size: 0.9em; color: var(--medium-grey);">
          Points to: <code style="background: var(--white); padding: 2px 8px;">http://localhost:3000</code>
        </p>
        <div class="note">
          <strong>Note:</strong> This version only works when Correspondence Clerk is running locally on port 3000.
        </div>
      </div>
    </div>

    <!-- Installation Steps -->
    <section class="steps-section">
      <h2>How to Install</h2>
      <ol class="steps">
        <li>
          <strong>Make your bookmarks bar visible</strong><br>
          In Chrome/Edge: Press <code>Ctrl+Shift+B</code> (Windows) or <code>Cmd+Shift+B</code> (Mac)<br>
          In Firefox: Right-click the toolbar and enable "Bookmarks Toolbar"
        </li>
        <li>
          <strong>Drag the button above to your bookmarks bar</strong><br>
          Click and hold on the button, then drag it up to your bookmarks toolbar
        </li>
        <li>
          <strong>That's it!</strong><br>
          You can now click this bookmark whenever you're viewing an email in Outlook Web
        </li>
      </ol>
    </section>

    <!-- How to Use -->
    <section class="steps-section">
      <h2>How to Use</h2>
      <div class="how-to-use">
        <div class="step-card">
          <div class="icon">ðŸ“§</div>
          <h3>Open an Email</h3>
          <p>View any email in Outlook Web (outlook.com or office.com)</p>
        </div>
        <div class="step-card">
          <div class="icon">ðŸ“Œ</div>
          <h3>Click Bookmark</h3>
          <p>Click the bookmarklet you just installed in your bookmarks bar</p>
        </div>
        <div class="step-card">
          <div class="icon">âœ…</div>
          <h3>File It</h3>
          <p>Correspondence Clerk opens with the email pre-filled, ready to save</p>
        </div>
      </div>
    </section>

    <!-- Troubleshooting -->
    <section class="troubleshooting">
      <h2>Troubleshooting</h2>

      <details>
        <summary>The bookmarklet doesn't work</summary>
        <p>Make sure you're on an Outlook Web page:</p>
        <ul>
          <li>outlook.com (consumer Outlook)</li>
          <li>outlook.office.com (Office 365)</li>
          <li>outlook.live.com</li>
        </ul>
        <p>The bookmarklet won't work on the Outlook desktop app - you need to use the web version.</p>
      </details>

      <details>
        <summary>Can't drag the button</summary>
        <p>Try these alternatives:</p>
        <ul>
          <li><strong>Right-click the button</strong> â†’ "Bookmark this link" or "Add to bookmarks"</li>
          <li><strong>Manually create a bookmark:</strong> Copy the bookmarklet code from the source files and paste it as the bookmark URL</li>
          <li>Make sure your browser allows JavaScript bookmarks (some security settings may block them)</li>
        </ul>
      </details>

      <details>
        <summary>"Could not extract email body" error</summary>
        <p>This means the bookmarklet can't find the email content. Try:</p>
        <ul>
          <li>Make sure you have an email fully open (not just selected in the inbox)</li>
          <li>Wait for the email to fully load before clicking the bookmarklet</li>
          <li>Try a different email - some emails may have unusual formatting</li>
          <li>Refresh the page and try again</li>
        </ul>
      </details>

      <details>
        <summary>Wrong email is extracted</summary>
        <p>If the bookmarklet extracts a different email than expected:</p>
        <ul>
          <li>Make sure the email you want is fully visible on screen</li>
          <li>Click directly on the email to ensure it's selected</li>
          <li>Scroll to the top of the email thread</li>
          <li>Close any other email preview panes</li>
        </ul>
      </details>

      <details>
        <summary>Local dev version doesn't work</summary>
        <p>The local development bookmarklet requires:</p>
        <ul>
          <li>Correspondence Clerk running on <code>http://localhost:3000</code></li>
          <li>Run <code>npm run dev</code> in your project directory first</li>
          <li>For different ports, you'll need to edit the bookmarklet code</li>
        </ul>
      </details>

      <details>
        <summary>Email data doesn't appear in Correspondence Clerk</summary>
        <p>If the tab opens but fields are empty:</p>
        <ul>
          <li>Check your browser's console for errors (F12 â†’ Console tab)</li>
          <li>Make sure you're logged into Correspondence Clerk</li>
          <li>Try closing the tab and clicking the bookmarklet again</li>
          <li>Check that the URL in the bookmarklet matches your Correspondence Clerk installation</li>
        </ul>
      </details>
    </section>

    <!-- Support Section -->
    <div class="support-section">
      <h2>Need More Help?</h2>
      <p>
        View the full documentation:
        <a href="https://correspondence-clerk.vercel.app/help" target="_blank">User Guide</a>
      </p>
      <p style="margin-top: 15px;">
        Or read the technical documentation:
        <a href="https://github.com/tomapperley8-del/correspondence-clerk/blob/master/OUTLOOK_INTEGRATION.md" target="_blank">Outlook Integration Guide</a>
      </p>
    </div>
  </div>

  <script>
    function switchVersion(version) {
      // Update button states
      const buttons = document.querySelectorAll('.version-btn');
      buttons.forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');

      // Show/hide content
      document.getElementById('production-version').classList.remove('active');
      document.getElementById('local-version').classList.remove('active');

      if (version === 'production') {
        document.getElementById('production-version').classList.add('active');
      } else {
        document.getElementById('local-version').classList.add('active');
      }
    }
  </script>
</body>
</html>
